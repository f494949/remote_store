(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-117c47ce"],{7416:function(e,t,s){"use strict";s.r(t);var n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"app-container"},[s("el-row",[s("el-col",{attrs:{span:24}},[s("el-col",{attrs:{span:24}},[s("h2",[e._v("在线人数: "+e._s(e.count))])]),s("el-col",{staticClass:"content padding-15",attrs:{id:"chatRecord",span:24}},e._l(e.groupChat,(function(t,n){return s("el-col",{key:n,class:e.clientId===t.clientId?"text-right":"",attrs:{span:24}},[s("p",[e._v(e._s(t.name)+" "),s("small",{staticStyle:{color:"#909399"}},[e._v(e._s(e.rTime(t.created_at)))])]),s("p",[e._v(e._s(t.message))])])})),1),s("el-col",{staticClass:"padding-15",attrs:{span:24}},[s("el-col",{attrs:{span:18}},[s("el-input",{ref:"input",attrs:{type:"text",placeholder:"请输入内容",autosize:"",resize:"none",maxlength:"100","show-word-limit":""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.send(t)}},model:{value:e.textarea,callback:function(t){e.textarea=t},expression:"textarea"}})],1),s("el-col",{attrs:{span:5,offset:1}},[s("el-button",{attrs:{type:"primary"},on:{click:e.send}},[e._v("Send")])],1)],1)],1)],1)],1)},o=[],a=(s("99af"),s("e9c4"),s("ed08")),c=s("5f87"),r=s("4360"),i={name:"Websocket",data:function(){return{textarea:"",count:0,clientId:0,groupChat:[]}},mounted:function(){var e=Object(c["a"])(),t="en";switch(r["a"].getters.language){case"zh":t="zh-CN";break;default:t="en"}if("WebSocket"in window){var s="wss://ityphp.newbanri.com/ws";this.websocket=new WebSocket("".concat(s,"?lang=").concat(t,"&token=").concat(e)),this.initWebSocket()}else this.$message.error("当前浏览器不支持websocket")},beforeDestroy:function(){this.onbeforeunload()},methods:{initWebSocket:function(){this.websocket.onerror=this.setErrorMessage,this.websocket.onopen=this.setOnopenMessage,this.websocket.onmessage=this.setOnmessageMessage,this.websocket.onclose=this.setOncloseMessage,window.onbeforeunload=this.onbeforeunload},setErrorMessage:function(){this.$message.error("WebSocket连接发生错误")},setOnopenMessage:function(){this.$message({message:"连接成功",type:"success"});var e={route:"websocket.gc.online"};this.websocket.send(JSON.stringify(e));var t={route:"websocket.gc.chatRecord"};this.websocket.send(JSON.stringify(t))},setOnmessageMessage:function(e){var t=JSON.parse(e.data);if("heart"!==t.type)if(!0===t.success){var s=t.data;switch(s.type){case"onWebSocketConnect":this.clientId=s.clientId;break;case"online":this.count=s.count;break;case"getChatRecord":this.groupChat=s.groupChat,this.$nextTick((function(){var e=document.getElementById("chatRecord");e.scrollTop=e.scrollHeight}));break;case"onClose":this.count=s.count;break;default:}}else this.$message.error(t.message)},setOncloseMessage:function(){this.$message("连接关闭")},onbeforeunload:function(){this.closeWebSocket()},closeWebSocket:function(){this.websocket.close()},send:function(){if(this.textarea.length>0){var e={route:"websocket.gc.send",data:{message:this.textarea}};this.websocket.send(JSON.stringify(e));var t={route:"websocket.gc.chatRecord"};this.websocket.send(JSON.stringify(t)),this.textarea=""}else this.$refs.input.focus()},rTime:function(e){return Object(a["g"])(e)}}},u=i,l=(s("ff0a"),s("2877")),d=Object(l["a"])(u,n,o,!1,null,"70132b22",null);t["default"]=d.exports},"81c6":function(e,t,s){},e9c4:function(e,t,s){var n=s("23e7"),o=s("d066"),a=s("d039"),c=o("JSON","stringify"),r=/[\uD800-\uDFFF]/g,i=/^[\uD800-\uDBFF]$/,u=/^[\uDC00-\uDFFF]$/,l=function(e,t,s){var n=s.charAt(t-1),o=s.charAt(t+1);return i.test(e)&&!u.test(o)||u.test(e)&&!i.test(n)?"\\u"+e.charCodeAt(0).toString(16):e},d=a((function(){return'"\\udf06\\ud834"'!==c("\udf06\ud834")||'"\\udead"'!==c("\udead")}));c&&n({target:"JSON",stat:!0,forced:d},{stringify:function(e,t,s){var n=c.apply(null,arguments);return"string"==typeof n?n.replace(r,l):n}})},ff0a:function(e,t,s){"use strict";s("81c6")}}]);